{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <a href="{% url 'dashboard' %}" class="btn btn-sm btn-outline-secondary mb-3">â† Back to Dashboard</a>

  <div class="card">
    <div class="card-body">
      <h2 class="card-title">{{ care_request.pet.name }} â€“ Care Request</h2>
      <p><strong>Location:</strong> {{ care_request.location }}</p>
      <p><strong>Dates:</strong> {{ care_request.start_date }} to {{ care_request.end_date }}</p>
      <p><strong>Instructions:</strong> {{ care_request.instructions }}</p>
    </div>
  </div>

  <hr>

  {% if user.is_sitter %}
    <div class="mb-3 mt-3">
      <a href="{% url 'public_profile' user_id=care_request.owner.id %}" class="btn btn-outline-primary me-2">
        ğŸ‘¤ View Owner Profile
      </a>
      <a href="{% url 'pet_detail' pet_id=care_request.pet.id %}" class="btn btn-outline-secondary">
        ğŸ¾ View Pet Details
      </a>
    </div>

    {% if existing_application %}
      <div class="alert alert-info mt-3">âœ… You have already applied for this request.</div>
    {% else %}
      <form method="post" class="mt-3">
        {% csrf_token %}
        <input type="hidden" name="action" value="apply_now">
        <button type="submit" class="btn btn-success">Apply Now</button>
      </form>
    {% endif %}
  {% endif %}

  {% if user == care_request.owner %}
    <h4 class="mt-4">ğŸ“¨ Applications Received</h4>
    {% if applications %}
      <ul class="list-group">
        {% for app in applications %}
          <li class="list-group-item">
            <strong>
              <a href="{% url 'public_profile' user_id=app.sitter.id %}">
                {{ app.sitter.username }}
              </a>
            </strong> â€” Current Status: <em>{{ app.status }}</em>

            <form method="post" class="mt-2 d-flex align-items-center">
              {% csrf_token %}
              <input type="hidden" name="action" value="update_status">
              <input type="hidden" name="application_id" value="{{ app.id }}">
              <select name="status" class="form-select form-select-sm me-2" style="width: auto;">
                <option value="Pending" {% if app.status == 'Pending' %}selected{% endif %}>Pending</option>
                <option value="Accepted" {% if app.status == 'Accepted' %}selected{% endif %}>Accepted</option>
                <option value="Rejected" {% if app.status == 'Rejected' %}selected{% endif %}>Rejected</option>
              </select>
              <button type="submit" class="btn btn-sm btn-success">Update</button>
            </form>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No sitters have applied yet.</p>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
